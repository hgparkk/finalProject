<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.codingbamboo.finalproject.noticeattach.dao.INoticeAttachDAO">


	<!-- 공지사항과 첨부파일 매핑 등록 -->
	<insert id="insertNoticeAttach"
		parameterType="com.codingbamboo.finalproject.noticeattach.dto.NoticeAttachDTO">
		INSERT INTO notice_attach (
		notice_no,
		attach_no
		) VALUES (
		#{noticeNo},
		#{attachNo}
		)
	</insert>

	<!-- 첨부파일 정보 추가 (attach 테이블에 삽입) -->
<insert id="insertAttach" parameterType="com.codingbamboo.finalproject.noticeattach.dto.NoticeAttachDTO" useGeneratedKeys="true" keyProperty="attachNo" keyColumn="ATTACH_NO">
    INSERT INTO attach (
        attach_no,
        attach_name,
        attach_original_name,
        attach_size,
        attach_type,
        attach_path
    ) VALUES (
        ATTACH_SEQ.NEXTVAL, 
        #{attachName}, 
        #{attachOriginalName}, 
        #{attachSize}, 
        #{attachType}, 
        #{attachPath}
    )
</insert>


	<!-- 공지사항 번호로 첨부파일 목록 조회 -->
	<select id="getAttachListByNoticeNo" parameterType="int"
		resultType="com.codingbamboo.finalproject.noticeattach.dto.NoticeAttachDTO">
		SELECT
		a.attach_no AS attachNo,
		a.attach_name AS attachName,
		a.attach_original_name AS attachOriginalName,
		a.attach_size AS
		attachSize,
		a.attach_type AS attachType,
		a.attach_path AS attachPath
		FROM attach a
		INNER JOIN notice_attach na ON a.attach_no = na.attach_no
		WHERE na.notice_no = #{noticeNo}
	</select>

	<!-- 공지사항 번호로 첨부파일 삭제 (notice_attach 테이블에서 삭제) -->
	<delete id="deleteAttachByNoticeNo" parameterType="int">
		DELETE FROM
		notice_attach
		WHERE notice_no = #{noticeNo}
	</delete>

	<!-- 첨부파일 번호로 첨부파일 삭제 (attach 테이블에서 삭제) -->
	<delete id="deleteAttachByAttachNo" parameterType="int">
		DELETE FROM
		attach
		WHERE attach_no = #{attachNo}
	</delete>



	<select id="getAttachByAttachNo" parameterType="int" resultType="com.codingbamboo.finalproject.noticeattach.dto.NoticeAttachDTO">
    SELECT 
        attach_no AS attachNo, 
        attach_name AS attachName, 
        attach_original_name AS attachOriginalName, 
        attach_size AS attachSize, 
        attach_type AS attachType, 
        attach_path AS attachPath 
    FROM attach 
    WHERE attach_no = #{attachNo}
</select>
	
</mapper>
