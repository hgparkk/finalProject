<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.codingbamboo.finalproject.noticeattach.dao.INoticeAttachDAO">

	<!-- 첨부파일 등록 -->
	<insert id="insertAttach"
		parameterType="com.codingbamboo.finalproject.noticeattach.dto.NoticeAttachDTO"
		useGeneratedKeys="true" keyProperty="attachNo" keyColumn="ATTACH_NO">
		INSERT INTO attach (
		attach_no, attach_name,
		attach_original_name, attach_size, attach_type,
		attach_path
		) VALUES (
		ATTACH_SEQ.NEXTVAL, #{attachName}, #{attachOriginalName},
		#{attachSize}, #{attachType},
		#{attachPath}
		)
	</insert>


	<!-- 특정 공지사항에 해당하는 첨부파일 리스트 가져오기 -->
	<select id="getAttachListByNoticeNo" parameterType="int"
		resultType="com.codingbamboo.finalproject.noticeattach.dto.NoticeAttachDTO">
		SELECT
		na.NA_NO AS naNo,
		na.NOTICE_NO AS noticeNo,
		na.ATTACH_NO AS attachNo,
		a.ATTACH_NAME AS attachName,
		a.ATTACH_ORIGINAL_NAME AS attachOriginalName,
		a.ATTACH_SIZE AS
		attachSize,
		a.ATTACH_PATH AS attachPath,
		a.ATTACH_TYPE AS attachType
		FROM NOTICE_ATTACH na
		JOIN ATTACH a ON na.ATTACH_NO = a.ATTACH_NO
		WHERE
		na.NOTICE_NO = #{noticeNo}
	</select>

	<insert id="insertNoticeAttach">
		INSERT INTO NOTICE_ATTACH (NA_NO, NOTICE_NO,
		ATTACH_NO)
		VALUES (NOTICE_ATTACH_SEQ.NEXTVAL, #{noticeNo}, #{attachNo})
	</insert>



	<!-- 특정 첨부파일 정보 가져오기 -->
	<select id="getAttachByAttachNo" parameterType="int"
		resultType="com.codingbamboo.finalproject.noticeattach.dto.NoticeAttachDTO">
		SELECT
		attach_no AS attachNo,
		attach_name AS attachName,
		attach_original_name AS attachOriginalName,
		attach_size AS attachSize,
		attach_type AS attachType,
		attach_path AS attachPath,
		notice_no AS
		noticeNo
		FROM attach
		WHERE attach_no = #{attachNo}
	</select>

	<!-- 특정 공지사항 번호에 연결된 첨부파일 삭제 -->
	<delete id="deleteAttachByNoticeNo" parameterType="int">
		DELETE FROM
		attach WHERE notice_no = #{noticeNo}
	</delete>

	<!-- 특정 첨부파일 삭제 -->
	<delete id="deleteAttachByAttachNo" parameterType="int">
		DELETE FROM
		attach WHERE attach_no = #{attachNo}
	</delete>

</mapper>
